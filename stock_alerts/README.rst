=============
Stock Alerts
=============

This module provides an automated stock alert system for Odoo 16. It monitors product inventory levels and generates notifications when stock falls below configurable thresholds.

Features
========

* **Configurable Minimum Stock**: Set minimum stock levels for each product
* **Automated Monitoring**: Scheduled action checks stock levels hourly
* **Smart Alerts**: Generates mail messages when stock is critical
* **Duplicate Prevention**: Tracks alert history to avoid unnecessary notifications
* **Alert Resolution**: Automatically marks alerts as resolved when stock is replenished
* **Dashboard Views**: Multiple views (Kanban, Tree, Pivot) to monitor critical stock
* **Category Grouping**: View and analyze critical stock by product category
* **Alert History**: Complete audit trail of all stock alerts

Installation
============

1. Install the module from Apps menu
2. The module depends on ``stock`` and ``mail`` modules
3. Demo data is available to test the functionality

Configuration
=============

Setting Minimum Stock Levels
-----------------------------

1. Navigate to **Inventory > Products > Products**
2. Open a storable product
3. Go to the **Inventory** tab
4. Set the **Minimum Stock** value
5. Save the product

The system will now monitor this product's stock level.

Configuring Alert Frequency
----------------------------

The automated stock check runs every hour by default. To change the frequency:

1. Navigate to **Settings > Technical > Automation > Scheduled Actions**
2. Find "Stock Alerts: Check Critical Stock Levels"
3. Modify the **Interval Number** and **Interval Type** as needed
4. Save the changes

Usage
=====

Viewing Critical Stock Dashboard
---------------------------------

1. Navigate to **Inventory > Stock Alerts > Critical Stock Dashboard**
2. The dashboard shows products with stock below minimum threshold
3. Products are grouped by category by default
4. Use filters to refine the view:
   
   * **Critical Stock**: Products currently below minimum
   * **Has Minimum Set**: All products with minimum stock configured

5. Available views:
   
   * **Kanban**: Visual cards showing product status
   * **Tree**: Detailed list view
   * **Pivot**: Analysis and reporting view

Viewing Alert History
---------------------

1. Navigate to **Inventory > Stock Alerts > Alert History**
2. View all alerts generated by the system
3. Default filter shows only active (unresolved) alerts
4. Use grouping options:
   
   * Group by Product
   * Group by Category
   * Group by Status
   * Group by Alert Date

Understanding Alerts
--------------------

**Active Alerts** (shown in red/warning):
- Stock is currently below minimum threshold
- Alert is unresolved
- Requires action

**Resolved Alerts** (shown in green):
- Stock has been replenished above minimum
- Alert automatically resolved
- Kept for historical records

Alert Workflow
==============

1. **Stock Falls Below Minimum**
   
   * Scheduled action detects low stock
   * Creates alert in history
   * Posts notification message to product's chatter
   * Alert marked as "Active"

2. **Stock Remains Low**
   
   * No duplicate alerts created
   * Existing alert remains active
   * System continues monitoring

3. **Stock Replenished**
   
   * Scheduled action detects adequate stock
   * Marks alert as "Resolved"
   * Posts resolution message to product's chatter
   * Records resolution date

4. **Stock Falls Again**
   
   * New alert can be created
   * Previous alert remains in history
   * Full audit trail maintained

Technical Details
=================

Models
------

**product.template** (Extended)
  * ``minimum_stock`` (Float): Minimum stock threshold
  * ``stock_below_minimum`` (Boolean, Computed): Current status indicator

** stock.alert.history** (New)
  * ``product_id``: Related product
  * ``alert_date``: When alert was generated
  * ``qty_available``: Stock level at alert time
  * ``minimum_stock``: Threshold at alert time
  * ``resolved``: Alert resolution status
  * ``resolved_date``: When alert was resolved
  * ``category_id``: Product category (for grouping)

Scheduled Actions
-----------------

**Stock Alerts: Check Critical Stock Levels**
  * Model: ``product.template``
  * Method: ``check_and_create_alerts()``
  * Default Frequency: Every 1 hour
  * Can be disabled/modified as needed

Security
--------

Access rights for ``stock.alert.history``:
  * Stock User: Full access (read, write, create, delete)
  * Stock Manager: Full access
  * All Users: Read-only access

Testing
=======

The module includes comprehensive automated tests:

* Alert generation for critical stock
* No alerts for adequate stock
* Duplicate alert prevention
* Alert resolution tracking
* Mail message creation
* Dashboard filtering and grouping

Run tests with:

.. code-block:: bash

   python odoo-bin -c odoo.conf -u stock_alerts --test-enable --stop-after-init

Demo Data
=========

Demo data includes:
  * Sample product categories (Electronics, Furniture)
  * 5 demo products with varying stock levels
  * Mix of critical and adequate stock situations
  * Sample alert history records

Credits
=======

* Developer: Ricardo Perez
* Version: 16.0.0.0.1
* License: AGPL-3

Changelog
=========

Version 16.0.0.0.1 (2025-11-28)
-------------------------------

* Initial release
* Minimum stock field on products
* Automated alert generation
* Dashboard with multiple views
* Alert history tracking
* Duplicate prevention system
* Comprehensive test coverage
